<script>
    function getParameterByName(name, url = window.location.href) {
        name = name.replace(/[\[\]]/g, '\\$&');
        const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
        const results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, ' '));
    }

    async function getAccessToken(state, code){
        let callback = window.location.origin + "/callback.html"

        let apiUrl = "https://accounts.spotify.com/api/token?grant_type=authorization_code&code=" + code + "&redirct_uri=" + callback
        let response = await fetch(apiUrl, {
            method: "POST",
            headers: {
                "content-type": "application/x-www-form-urlencoded",
                "Authorization": "Basic " + code
            },
        })
        let json = await response.getJson()
        console.log(json)
    }

    let code = getParameterByName("code", window.location.href)

    getAccessToken("", code)
    //console.log(window.location.search)
</script>